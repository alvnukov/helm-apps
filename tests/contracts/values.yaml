global:
  env: production
  deploy:
    enabled: true
    release:
      _default: production-v1
      production: production-v1
      dev: production-v1
  releases:
    production-v1:
      release-web: "3.19"
  _includes:
    base-a:
      data:
        fromBaseA: "A"
    base-b:
      data:
        fromBaseB: "B"
    profile-base:
      enabled: true
      _include: ["base-a"]
      envVars:
        A: "1"
        ENV_SWITCH:
          _default: "base-default"
          production: "base-production"
      data:
        key1: "value-1"
        key2: "base-value-2"
    profile-override:
      _include: ["base-b"]
      envVars:
        A: "2"
        ENV_SWITCH:
          _default: "override-default"
      data:
        key2: "override-value-2"
        key4: "value-4"

jwtSigningMethod: rsa
_include_files:
  - deployments-values.yaml

apps-configmaps:
  common-runtime-cm:
    enabled: true
    envVars:
      APP_MODE: runtime
      APP_ZONE:
        _default: eu-west-1
        production: eu-central-1
  merge-contract:
    _include: ["profile-base", "profile-override"]
    enabled: true
    envVars:
      LOCAL: "ok"
    data:
      key2: "local-value-2"
      key3: "value-3"
  compat-config:
    enabled: true
    extraFields: |
      immutable: true
    data:
      key: value

apps-stateless:
  release-auto-app:
    enabled: false
    versionKey: release-web
    containers:
      main:
        image:
          name: alpine
        command: |
          - sh
        args: |
          - -c
          - sleep 3600
  compat-service:
    enabled: true
    extraSpec: |
      paused: true
    podSpecExtra: |
      os:
        name: linux
    containers:
      main:
        image:
          name: alpine
          staticTag: "3"
        command: |
          - sh
        args: |
          - -c
          - sleep 3600
        ports: |
          - name: http
            containerPort: 8080
        extraFields: |
          resizePolicy:
            - resourceName: cpu
              restartPolicy: NotRequired
        sharedEnvSecrets:
          - common-runtime
        sharedEnvConfigMaps:
          - common-runtime-cm
    service:
      enabled: true
      type: LoadBalancer
      allocateLoadBalancerNodePorts: true
      loadBalancerClass: internal-vip
      internalTrafficPolicy: Local
      ipFamilyPolicy: SingleStack
      ipFamilies: |
        - IPv4
      ports: |
        - name: http
          port: 80
          targetPort: 8080
      extraSpec: |
        externalTrafficPolicy: Local
  compat-env-old:
    enabled: true
    containers:
      main:
        image:
          name: alpine
          staticTag: "3"
        command: |
          - sh
        args: |
          - -c
          - sleep 3600
        envFrom: |
          - secretRef:
              name: "manual-env-old"
        secretEnvVars:
          ORDER_KEY: "from-secret-env-vars"
  compat-env-mixed:
    enabled: true
    containers:
      main:
        image:
          name: alpine
          staticTag: "3"
        command: |
          - sh
        args: |
          - -c
          - sleep 3600
        sharedEnvSecrets:
          - common-runtime
        envFrom: |
          - secretRef:
              name: "manual-env-mixed"
        secretEnvVars:
          ORDER_KEY: "from-secret-env-vars"

apps-jobs:
  compat-job:
    enabled: true
    containers:
      main:
        image:
          name: alpine
          staticTag: "3"
        command: |
          - sh
        args: |
          - -c
          - echo test
    jobTemplateExtraSpec: |
      podFailurePolicy:
        rules: []

apps-ingresses:
  compat-ingress:
    enabled: true
    host: app.example.com
    paths: |
      - path: /
        pathType: Prefix
        backend:
          service:
            name: compat-service
            port:
              number: 80
    extraSpec: |
      defaultBackend:
        service:
          name: compat-service
          port:
            number: 80

apps-network-policies:
  compat-netpol:
    enabled: true
    type: kubernetes
    podSelector: |
      matchLabels:
        app: compat-service
    policyTypes: |
      - Ingress
      - Egress
    ingress: |
      - from:
          - namespaceSelector:
              matchLabels:
                kubernetes.io/metadata.name: ingress-nginx
    egress: |
      - to:
          - namespaceSelector:
              matchLabels:
                kubernetes.io/metadata.name: kube-system
        ports:
          - protocol: UDP
            port: 53
  compat-cilium-netpol:
    enabled: true
    type: cilium
    spec: |
      endpointSelector:
        matchLabels:
          app: compat-service
      egress:
        - toEndpoints:
            - matchLabels:
                k8s:io.kubernetes.pod.namespace: kube-system
  compat-calico-netpol:
    enabled: true
    type: calico
    selector: "app == 'compat-service'"
    ingress: |
      - action: Allow
        source:
          selector: "kubernetes.io/metadata.name == 'ingress-nginx'"
    egress: |
      - action: Allow
        destination:
          selector: "kubernetes.io/metadata.name == 'kube-system'"

apps-pvcs:
  compat-pvc:
    enabled: true
    accessModes: |
      - ReadWriteOnce
    resources: |
      requests:
        storage: 1Gi
    extraSpec: |
      volumeMode: Filesystem

apps-secrets:
  common-runtime:
    enabled: true
    envVars:
      SHARED_REGION:
        _default: eu-central-1
        "^dev.*$": eu-west-1
      SHARED_MODE: "strict"
      ORDER_KEY: "from-shared"
  manual-env-old:
    enabled: true
    envVars:
      ORDER_KEY: "from-manual-old"
  manual-env-mixed:
    enabled: true
    envVars:
      ORDER_KEY: "from-manual-mixed"
  compat-secret:
    enabled: true
    extraFields: |
      stringData:
        token: value

custom-group-contract:
  __GroupVars__:
    type: apps-configmaps
  custom-group-cm:
    enabled: true
    data:
      custom: "ok"

apps-routes-contract:
  __GroupVars__:
    type:
      _default: apps-ingresses
    paths: |
      - path: /
        pathType: Prefix
        backend:
          service:
            name: compat-service
            port:
              number: 80
    _groupPreRenderHook: |
      {{- if not (hasKey $.CurrentApp "paths") }}
      {{- $_ := set $.CurrentApp "paths" $.CurrentGroupVars.paths }}
      {{- end }}
  compat-route:
    enabled: true
    host: route.example.com
    service: "compat-service"

apps-stateful:
  compat-stateful:
    enabled: true
    replicas: 1
    containers:
      main:
        image:
          name: alpine
          staticTag: "3"
        command: |
          - sh
        args: |
          - -c
          - sleep 3600
        ports: |
          - name: http
            containerPort: 8081
    service:
      enabled: true
      ports: |
        - name: http
          port: 81
          targetPort: 8081

apps-cronjobs:
  compat-cron:
    enabled: true
    schedule: "*/10 * * * *"
    successfulJobsHistoryLimit: 1
    failedJobsHistoryLimit: 1
    containers:
      main:
        image:
          name: alpine
          staticTag: "3"
        command: |
          - sh
        args: |
          - -c
          - echo cron

apps-services:
  compat-standalone-service:
    enabled: true
    selector: |
      app: compat-service
    ports: |
      - name: metrics
        port: 9090
        targetPort: 9090

apps-limit-range:
  compat-limit-range:
    enabled: true
    limits: |
      - type: Container
        default:
          memory: 256Mi
        defaultRequest:
          memory: 128Mi

apps-certificates:
  compat-certificate:
    enabled: true
    host: compat.example.com

apps-dex-authenticators:
  compat-dex-auth:
    enabled: true
    applicationDomain: "compat.example.com"
    applicationIngressClassName: "nginx"
    applicationIngressCertificateSecretName: "compat-example-tls"
    allowedGroups: |
      - platform-admins
    sendAuthorizationHeader: "true"

apps-dex-clients:
  compat-dex-client:
    enabled: true
    redirectURIs: |
      - "https://compat.example.com/callback"

apps-custom-prometheus-rules:
  compat-rules:
    enabled: true
    groups:
      compat-group:
        alerts:
          compat-alert:
            isTemplate: false
            content: |
              expr: vector(1)
              for: 1m
              labels:
                severity_level: "5"
              annotations:
                summary: "compat alert"

apps-grafana-dashboards:
  compat-dashboard:
    enabled: true
    folder: "Compatibility"

apps-kafka-strimzi:
  compat-kafka:
    enabled: true
    version: 3.7.0
    replicas: 1
    resources:
      requests:
        mcpu: 100
        memoryMb: 512
      limits:
        memoryMb: 512
    jvmOptions: |
      -Xms: 256m
      -Xmx: 256m
    storage:
      size: 1Gi
      class: standard
    exporter:
      resources:
        requests:
          mcpu: 50
          memoryMb: 128
        limits:
          memoryMb: 128
    zookeeper:
      replicas: 1
      resources:
        requests:
          mcpu: 100
          memoryMb: 512
        limits:
          memoryMb: 512
      metricsConfig: |
        type: jmxPrometheusExporter
        valueFrom:
          configMapKeyRef:
            name: kafka-metrics
            key: zookeeper.yml
      jvmOptions: |
        -Xms: 256m
        -Xmx: 256m
      storage:
        size: 1Gi
        class: standard
      affinity: |
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: kubernetes.io/os
                    operator: In
                    values:
                      - linux
    entityOperator:
      topicOperator:
        resources:
          requests:
            mcpu: 50
            memoryMb: 256
          limits:
            memoryMb: 256
      userOperator:
        resources:
          requests:
            mcpu: 50
            memoryMb: 256
          limits:
            memoryMb: 256
    topics:
      compat-topic:
        partitions: 1
        replicas: 1
        retention: 60000
        segment_bytes: 1048576
        min_insync_replicas: 1

apps-infra:
  node-users:
    compat-user:
      enabled: true
      uid: 2001
      isSudoer: true
      annotations: |
        owner: platform
      labels: |
        team: platform
  node-groups:
    compat-group:
      enabled: true
